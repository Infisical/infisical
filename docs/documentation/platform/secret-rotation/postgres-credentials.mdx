---
title: "PostgreSQL credential rotation"
description: "Automatically rotate PostgreSQL database users with zero downtime."
---

Infisical rotates PostgreSQL credentials using the [two-user strategy](/documentation/platform/secret-rotation/overview#two-user-rotation). This rotation strategy requires two dedicated database users and an optional manager user with `CREATEROLE` privileges. Infisical will update the password for one user while the other remains active, ensuring that your application always has a valid connection.

## Prerequisites

Before configuring rotation for PostgreSQL credentials, ensure you have:

- A PostgreSQL database
- Sufficient permissions to alter users

## Initial setup

<Steps>
  <Step title="(Recommended) Create manager user">
    Create a dedicated user that Infisical will use to rotate credentials. This user requires the `CREATEROLE` privilege.

    ```sql
    -- Create the manager user
    CREATE USER infisical_manager WITH PASSWORD 'your-secure-password';

    -- Grant the ability to manage other roles
    ALTER USER infisical_manager WITH CREATEROLE;

    -- Grant schema permissions to allow managing table access if needed
    GRANT USAGE ON SCHEMA public TO infisical_manager;
    ```

    <Note>
      You can use a `superuser` such as `postgres` to perform the rotation. However,
      we recommend creating a dedicated manager user with `CREATEROLE` privileges to
      reduce the risk of privilege escalation.
    </Note>

  </Step>

<Step title="Configure PostgreSQL connection">
  Configure a [PostgreSQL connection](/integrations/app-connections/postgres) in
  Infisical using the `infisical_manager` credentials you just created.
</Step>

  <Step title="Create rotation users">
    These are the users your application will actually use to connect. `infisical_manager` must be able to modify them.

    ```sql
    -- Create the application users
    CREATE USER app_user_a WITH PASSWORD 'initial_placeholder_password';
    CREATE USER app_user_b WITH PASSWORD 'initial_placeholder_password';

    -- Grant them access to your database
    GRANT CONNECT ON DATABASE my_app_db TO app_user_a;
    GRANT CONNECT ON DATABASE my_app_db TO app_user_b;

    -- Grant permissions to the manager so it can rotate them
    GRANT app_user_a TO infisical_manager;
    GRANT app_user_b TO infisical_manager;
    ```

  </Step>
</Steps>

## Configuration

<Steps>
  <Step title="Add Secret Rotation">
    In the Infisical Dashboard, go to your project's **Secret Rotation** page and click **Add Secret Rotation**. Select **PostgreSQL Credentials**.
  </Step>

<Step title="Configure Connection">
  Select an existing **PostgreSQL Connection** or create a new one. - The
  connection must authenticate as a user with permission to change passwords
  (e.g., the `infisical_rotator` we created above). - Set the **Rotation
  Interval** (e.g., 30 days).
</Step>

<Step title="Define Users">
  Enter the names of the two users you created in the prerequisites: - **User
  A**: `app_user_a` - **User B**: `app_user_b`
</Step>

  <Step title="Map to Secrets">
    Map the generated credentials to secrets in your Infisical project.
    - **Username Secret**: e.g., `DB_USERNAME`
    - **Password Secret**: e.g., `DB_PASSWORD`
    
    When Infisical rotates, it will update `DB_USERNAME` to either `app_user_a` or `app_user_b`, and `DB_PASSWORD` to the new random password.
  </Step>
</Steps>

## Testing the Rotation

We recommend testing the rotation immediately after setup to ensure permissions are correct.

1.  **Trigger a Manual Rotation**: In the UI, click the "Rotate Now" button.
2.  **Check the Logs**: Look for a "Success" status.
3.  **Verify Connection**:
    - Go to your **Secrets Dashboard** and reveal the current value of `DB_USERNAME` and `DB_PASSWORD`.
    - Use a database tool like **Beekeeper Studio** or `psql` to try connecting with those exact credentials.

    ```bash
    # Example psql test
    psql "postgres://<user>:<password>@<host>:<port>/<dbname>"
    ```

<Note>
  If the rotation fails, check the logs. usually, it's because the connection
  user lacks the `CREATEROLE` permission or the network blocks Infisical from
  reaching your database.
</Note>
