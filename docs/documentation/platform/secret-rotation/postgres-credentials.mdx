---
title: "PostgreSQL Credentials"
description: "Automatically rotate PostgreSQL database users with zero downtime."
---

Infisical rotates PostgreSQL credentials using the **Dual User** strategy. This requires two dedicated database users. Infisical will alternatingly update the password for one user while the other remains active, ensuring that your application always has a valid connection.

## Prerequisites

Before starting, you need a PostgreSQL database and a user with `CREATEROLE` privileges (or sufficient permissions to alter the target users).

### 1. Create Data Users

Create two users that Infisical will rotate. Let's call them `app_user_a` and `app_user_b`.

```sql
-- Create the two users (passwords will be overwritten by Infisical immediately)
CREATE USER app_user_a WITH PASSWORD 'initial_placeholder_password';
CREATE USER app_user_b WITH PASSWORD 'initial_placeholder_password';

-- Grant them access to your application's database
GRANT CONNECT ON DATABASE my_app_db TO app_user_a;
GRANT CONNECT ON DATABASE my_app_db TO app_user_b;

-- Grant table permissions (adjust schema as needed)
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user_a;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user_b;
```

### 2. Create a Rotator User (Optional)

You typically provide Infisical with a "Superuser" or an admin connection. However, following the principle of least privilege, you can create a specific user just for performing rotations.

```sql
CREATE USER infisical_rotator WITH PASSWORD 'strong_password';
ALTER USER infisical_rotator WITH CREATEROLE;
-- CREATEROLE is usually required to change other users' passwords.
```

## Configuration

<Steps>
  <Step title="Add Secret Rotation">
    In the Infisical Dashboard, go to your project's **Secret Rotation** page and click **Add Secret Rotation**. Select **PostgreSQL Credentials**.
  </Step>

<Step title="Configure Connection">
  Select an existing **PostgreSQL Connection** or create a new one. - The
  connection must authenticate as a user with permission to change passwords
  (e.g., the `infisical_rotator` we created above). - Set the **Rotation
  Interval** (e.g., 30 days).
</Step>

<Step title="Define Users">
  Enter the names of the two users you created in the prerequisites: - **User
  A**: `app_user_a` - **User B**: `app_user_b`
</Step>

  <Step title="Map to Secrets">
    Map the generated credentials to secrets in your Infisical project.
    - **Username Secret**: e.g., `DB_USERNAME`
    - **Password Secret**: e.g., `DB_PASSWORD`
    
    When Infisical rotates, it will update `DB_USERNAME` to either `app_user_a` or `app_user_b`, and `DB_PASSWORD` to the new random password.
  </Step>
</Steps>

## Testing the Rotation

We recommend testing the rotation immediately after setup to ensure permissions are correct.

1.  **Trigger a Manual Rotation**: In the UI, click the "Rotate Now" button.
2.  **Check the Logs**: Look for a "Success" status.
3.  **Verify Connection**:
    - Go to your **Secrets Dashboard** and reveal the current value of `DB_USERNAME` and `DB_PASSWORD`.
    - Use a database tool like **Beekeeper Studio** or `psql` to try connecting with those exact credentials.

    ```bash
    # Example psql test
    psql "postgres://<user>:<password>@<host>:<port>/<dbname>"
    ```

<Note>
  If the rotation fails, check the logs. usually, it's because the connection
  user lacks the `CREATEROLE` permission or the network blocks Infisical from
  reaching your database.
</Note>
