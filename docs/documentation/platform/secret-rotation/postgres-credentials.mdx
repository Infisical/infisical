---
title: "PostgreSQL credential rotation"
description: "Automatically rotate PostgreSQL database users with zero downtime."
---

Infisical rotates PostgreSQL credentials using the [two-user strategy](/documentation/platform/secret-rotation/overview#two-user-rotation). This rotation strategy requires two dedicated database users and an optional manager user with `CREATEROLE` privileges. Infisical will update the password for one user while the other remains active, ensuring that your application always has a valid connection.

## Prerequisites

Before configuring rotation for PostgreSQL credentials, ensure you have:

- A PostgreSQL database
- Sufficient permissions to alter users

## Initial setup

<Steps>
  <Step title="(Recommended) Create manager user">
    Create a dedicated user that Infisical will use to rotate credentials. This user requires the `CREATEROLE` privilege.

    ```sql
    -- Create the manager user
    CREATE USER infisical_manager WITH PASSWORD 'your-secure-password';

    -- Grant the ability to manage other roles
    ALTER USER infisical_manager WITH CREATEROLE;

    -- Grant schema permissions to allow managing table access if needed
    GRANT USAGE ON SCHEMA public TO infisical_manager;
    ```

    <Note>
      You can use a `superuser` such as `postgres` to perform the rotation. However,
      we recommend creating a dedicated manager user with `CREATEROLE` privileges to
      reduce the risk of privilege escalation.
    </Note>

  </Step>

<Step title="Configure PostgreSQL connection">
  Configure a [PostgreSQL connection](/integrations/app-connections/postgres) in
  Infisical using the `infisical_manager` credentials you just created.
</Step>

  <Step title="Create rotation users">
    These are the users your application will actually use to connect. `infisical_manager` must be able to modify them.

    ```sql
    -- Create the application users
    CREATE USER app_user_a WITH PASSWORD 'initial_placeholder_password';
    CREATE USER app_user_b WITH PASSWORD 'initial_placeholder_password';

    -- Grant them access to your database
    GRANT CONNECT ON DATABASE my_app_db TO app_user_a;
    GRANT CONNECT ON DATABASE my_app_db TO app_user_b;

    -- Grant permissions to the manager so it can rotate them
    GRANT app_user_a TO infisical_manager;
    GRANT app_user_b TO infisical_manager;
    ```

  </Step>
</Steps>

## Configure Secret Rotation

To configure Infisical Secret Rotation for PostgreSQL credentials:

<Tabs>

<Tab title="Infisical UI">

1. In the [Infisical dashboard](https://app.infisical.com/), choose your Secrets Management project.
2. In **Overview**, select the **Add Secret** dropdown, then choose **Add Secret Rotation**.
3. Choose **PostgreSQL Credentials**.
4. In **PostgreSQL Connection**, select the connection you created.
5. Set the rotation interval and time. If you want Infisical to rotate secrets automatically, turn on **Auto-Rotation Enabled**.
6. Select **Next**.
7. In **Parameters** > **General**, set **Database Username 1** and **Database Username 2** to the names of the two rotation users you created previously (for example, `app_user_a` and `app_user_b`).
8. (Optional) In **Advanced**, customize the rotation behavior:
   - **Rotation Statement**: The SQL query used to update the password. Infisical defaults to `ALTER USER ${username} WITH PASSWORD '${password}'`.
   - **Password Requirements**: The complexity rules for the generated password.
9. Select **Next**.
10. In **Mappings**, input the secret names that Infisical will update when rotating credentials:
    - **Username**: The secret that will store the active username (for example, `DB_USERNAME`).
    - **Password**: The secret that will store the active password (for example, `DB_PASSWORD`).
11. Select **Next**.
12. (Optional) Input a name and description for the rotation. Select **Next**.
13. Review your configuration, then select **Create Secret Rotation**.

</Tab>

<Tab title="API">

To create a PostgreSQL credentials rotation, make an API request to the [Create PostgreSQL Credentials Rotation](/api-reference/endpoints/secret-rotations/postgres-credentials/create) API endpoint. For example:

```bash Example request
curl --request POST \
--url https://us.infisical.com/api/v2/secret-rotations/postgres-credentials \
--header 'Content-Type: application/json' \
--data '{
    "name": "my-postgres-rotation",
    "projectId": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
    "description": "my database credentials rotation",
    "connectionId": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
    "environment": "dev",
    "secretPath": "/",
    "isAutoRotationEnabled": true,
    "rotationInterval": 30,
    "rotateAtUtc": {
        "hours": 0,
        "minutes": 0
    },
    "parameters": {
        "username1": "app_user_a",
        "username2": "app_user_b"
    },
    "secretsMapping": {
        "username": "DB_USERNAME",
        "password": "DB_PASSWORD"
    }
}'
```

The API will return a response similar to the following:

```bash Example response
{
    "secretRotation": {
        "id": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
        "name": "my-postgres-rotation",
        "description": "my database credentials rotation",
        "secretsMapping": {
            "username": "DB_USERNAME",
            "password": "DB_PASSWORD"
        },
        "isAutoRotationEnabled": true,
        "activeIndex": 0,
        "folderId": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
        "connectionId": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
        "createdAt": "2023-11-07T05:31:56Z",
        "updatedAt": "2023-11-07T05:31:56Z",
        "rotationInterval": 30,
        "rotationStatus": "success",
        "lastRotationAttemptedAt": "2023-11-07T05:31:56Z",
        "lastRotatedAt": "2023-11-07T05:31:56Z",
        "lastRotationJobId": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
        "nextRotationAt": "2023-11-07T05:31:56Z",
        "connection": {
            "app": "postgres-credentials",
            "name": "my-postgres-connection",
            "id": "3c90c3cc-0d44-4b50-8888-8dd25736052a"
        },
        "environment": {
            "slug": "dev",
            "name": "Development",
            "id": "3c90c3cc-0d44-4b50-8888-8dd25736052a"
        },
        "projectId": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
        "folder": {
            "id": "3c90c3cc-0d44-4b50-8888-8dd25736052a",
            "path": "/"
        },
        "rotateAtUtc": {
            "hours": 0,
            "minutes": 0
        },
        "lastRotationMessage": null,
        "type": "postgres-credentials",
        "parameters": {
            "username1": "app_user_a",
            "username2": "app_user_b"
        }
    }
}
```

</Tab>

</Tabs>
